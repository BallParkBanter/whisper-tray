@echo off
:: WhisperTray Cleanup / Uninstall Tool
:: Double-click to run - no configuration needed

powershell.exe -ExecutionPolicy Bypass -NoProfile -Command "& { Write-Host '========================================' -ForegroundColor Cyan; Write-Host '  WhisperTray Cleanup / Uninstall Tool' -ForegroundColor Cyan; Write-Host '========================================' -ForegroundColor Cyan; Write-Host ''; Write-Host '[1/7] Stopping WhisperTray processes...' -ForegroundColor Yellow; $procs = Get-Process | Where-Object { $_.ProcessName -like '*WhisperTray*' }; if ($procs) { foreach ($p in $procs) { try { Write-Host ('      Stopping: ' + $p.ProcessName + ' (PID: ' + $p.Id + ')') -ForegroundColor Yellow; Stop-Process -Id $p.Id -Force -ErrorAction Stop; Write-Host ('      Stopped: ' + $p.ProcessName) -ForegroundColor Green } catch { Write-Host ('      Failed to stop: ' + $p.ProcessName) -ForegroundColor Red } }; Write-Host '      Waiting for processes to terminate...' -ForegroundColor Gray; Start-Sleep -Seconds 2 } else { Write-Host '      No WhisperTray processes running' -ForegroundColor Gray }; Write-Host '[2/7] Removing config folder...' -ForegroundColor Yellow; $cfg = $env:APPDATA + '\WhisperTray'; if (Test-Path $cfg) { try { Remove-Item -Path $cfg -Recurse -Force -ErrorAction Stop; Write-Host ('      Removed: ' + $cfg) -ForegroundColor Green } catch { Write-Host ('      FAILED to remove: ' + $cfg) -ForegroundColor Red } } else { Write-Host ('      Not found: ' + $cfg) -ForegroundColor Gray }; Write-Host '[3/7] Removing Start Menu shortcut...' -ForegroundColor Yellow; $sm = $env:APPDATA + '\Microsoft\Windows\Start Menu\Programs\WhisperTray.lnk'; if (Test-Path $sm) { Remove-Item -Path $sm -Force; Write-Host '      Removed' -ForegroundColor Green } else { Write-Host '      Not found' -ForegroundColor Gray }; Write-Host '[4/7] Removing Startup shortcut...' -ForegroundColor Yellow; $su = $env:APPDATA + '\Microsoft\Windows\Start Menu\Programs\Startup\WhisperTray.lnk'; if (Test-Path $su) { Remove-Item -Path $su -Force; Write-Host '      Removed' -ForegroundColor Green } else { Write-Host '      Not found' -ForegroundColor Gray }; Write-Host '[5/7] Removing app folders...' -ForegroundColor Yellow; $foundAny = $false; @('C:\whisper-tray', ($env:LOCALAPPDATA + '\WhisperTray'), ($env:USERPROFILE + '\whisper-tray')) | ForEach-Object { if (Test-Path $_) { Remove-Item -Path $_ -Recurse -Force; Write-Host ('      Removed: ' + $_) -ForegroundColor Green; $foundAny = $true } }; if (-not $foundAny) { Write-Host '      No app folders found' -ForegroundColor Gray }; Write-Host '[6/7] Clearing PyInstaller temp files...' -ForegroundColor Yellow; $mei = Get-ChildItem -Path $env:TEMP -Filter '_MEI*' -Directory -ErrorAction SilentlyContinue; if ($mei) { foreach ($d in $mei) { try { Remove-Item -Path $d.FullName -Recurse -Force -ErrorAction Stop; Write-Host ('      Removed: ' + $d.Name) -ForegroundColor Green } catch { Write-Host ('      Could not remove: ' + $d.Name + ' (in use)') -ForegroundColor Yellow } } } else { Write-Host '      No PyInstaller temp directories found' -ForegroundColor Gray }; Write-Host '[7/7] Whisper models...' -ForegroundColor Yellow; $mp = $env:USERPROFILE + '\.cache\huggingface\hub'; $models = Get-ChildItem -Path $mp -Filter 'models--*faster-whisper*' -Directory -ErrorAction SilentlyContinue; if ($models) { Write-Host ('      Found ' + $models.Count + ' model(s) in cache (NOT deleted)') -ForegroundColor Magenta; foreach ($m in $models) { Write-Host ('        - ' + $m.Name) -ForegroundColor Gray } } else { Write-Host '      No cached models found' -ForegroundColor Gray }; Write-Host ''; Write-Host '========================================' -ForegroundColor Cyan; Write-Host '  Cleanup Complete!' -ForegroundColor Green; Write-Host '========================================' -ForegroundColor Cyan; Write-Host ''; Write-Host 'Ready for fresh install. Run WhisperTray.exe' -ForegroundColor White; Write-Host ''; Read-Host 'Press Enter to close' }"
